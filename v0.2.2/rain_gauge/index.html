<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>RainGauge · RainMaker.jl</title><meta name="title" content="RainGauge · RainMaker.jl"/><meta property="og:title" content="RainGauge · RainMaker.jl"/><meta property="twitter:title" content="RainGauge · RainMaker.jl"/><meta name="description" content="Documentation for RainMaker.jl."/><meta property="og:description" content="Documentation for RainMaker.jl."/><meta property="twitter:description" content="Documentation for RainMaker.jl."/><meta property="og:url" content="https://speedyweather.github.io/RainMaker.jl/rain_gauge/"/><meta property="twitter:url" content="https://speedyweather.github.io/RainMaker.jl/rain_gauge/"/><link rel="canonical" href="https://speedyweather.github.io/RainMaker.jl/rain_gauge/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">RainMaker.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../new_to_julia/">New to Julia?</a></li><li class="is-active"><a class="tocitem" href>RainGauge</a><ul class="internal"><li><a class="tocitem" href="#Adding-RainGauge-as-callback"><span>Adding RainGauge as callback</span></a></li><li><a class="tocitem" href="#Continuous-measurements-across-simulations"><span>Continuous measurements across simulations</span></a></li><li><a class="tocitem" href="#Skipping-first-days"><span>Skipping first days</span></a></li><li><a class="tocitem" href="#Visualising-RainGauge-measurements"><span>Visualising RainGauge measurements</span></a></li><li><a class="tocitem" href="#Visualising-accumulated-rainfall-globally"><span>Visualising accumulated rainfall globally</span></a></li><li><a class="tocitem" href="#Discarding-spin-up"><span>Discarding spin-up</span></a></li><li><a class="tocitem" href="#Functions-and-types"><span>Functions and types</span></a></li></ul></li><li><span class="tocitem">RainMaker challenge</span><ul><li><a class="tocitem" href="../instructions/">Instructions</a></li><li><a class="tocitem" href="../submit/">Submit</a></li><li><a class="tocitem" href="../leaderboard/">Leaderboard</a></li><li><a class="tocitem" href="../submissions/">List of submissions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>RainGauge</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>RainGauge</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/RainMaker.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/RainMaker.jl/blob/main/docs/src/rain_gauge.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="RainGauge"><a class="docs-heading-anchor" href="#RainGauge">RainGauge</a><a id="RainGauge-1"></a><a class="docs-heading-anchor-permalink" href="#RainGauge" title="Permalink"></a></h1><p>RainMaker.jl exports the callback <code>RainGauge</code>, a rain gauge that you can place inside a SpeedyWeather simulation to measures precipitation at a given location. The following explains how to use this <code>RainGauge</code> callback. </p><p>With a <code>SpectralGrid</code> from <a href="https://github.com/SpeedyWeather/SpeedyWeather.jl">SpeedyWeather.jl</a> (see <a href="https://speedyweather.github.io/SpeedyWeather.jl/dev/how_to_run_speedy/#SpectralGrid">here</a>) you can create <code>RainGauge</code> (it needs to know the spectral grid to interpolate from gridded fields to a given location). In most cases you will probably want to specify the rain gauge&#39;s location with <code>lond</code> (0...360˚E, -180...180˚E also work) and <code>latd</code> (-90...90˚N)`</p><pre><code class="language-julia hljs">using SpeedyWeather, RainMaker

spectral_grid = SpectralGrid()  # default resolution
rain_gauge = RainGauge(spectral_grid, lond=358.75, latd=51.75)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">RainGauge{Float32, AnvilInterpolator{Float32, SpeedyWeather.RingGrids.GridGeometry{OctahedralGaussianGrid{SpeedyWeather.Architectures.CPU{KernelAbstractions.CPU}, Vector{UnitRange{Int64}}, Vector{Int64}}, Vector{Float64}, Vector{Int64}}, SpeedyWeather.RingGrids.AnvilLocator{Float32, Vector{Float32}, Vector{Int64}}}} &lt;: AbstractCallback
├ lond::Float64 = 358.75˚E
├ latd::Float64 = 51.75˚N
├ measurement_counter:Int = 0 (uninitialized)
├ tstart::DateTime = 2000-01-01T00:00:00
├ Δt::Second 1800 seconds
├ max_measurements::Int = 100000 (measuring for up to ~5.7 years, 0% recorded)
├ accumulated_rain_large_scale::Vector{Float32}, maximum: 0.0 mm
├ accumulated_rain_convection::Vector{Float32}, maximum: 0.0 mm
└ accumulated total precipitation: 0.000 mm</code></pre><p>(also see <code>?RainGauge</code> for more information). The <code>measurement_counter</code> starts at <code>0</code> and just counts up the number of measurements the rain gauge has made, one per timestep – zero also means that the gauge is not initialized. In order to reconstruct the time axis the fields <code>tstart</code> and <code>Δt</code> are used but they will be automatically set when initialized given the time step in the model. At any time you can always <code>reset!(rain_gauge)</code> in order to reset the counter, time and all rainfall measurements. But a <code>RainGauge</code> is also mutable, meaning you can do this by hand too, e.g. <code>rain_gauge.accumulated_rain_large_scale .= 0</code>.</p><p><code>RainGauge</code> has two vectors <code>accumulated_rain_large_scale</code> and <code>accumulated_rain_convection</code> where every entry is one measurement of the given precipitation type at the specified location. One measurement is taken after every time step of the model simulation. In order to preallocate these vectors we use <code>max_measurements</code> as length, meaning those are the maximum number of measurements that will be taken. An info is thrown when this point is reached and also an instance of <code>RainGauge</code> printed to the terminal shows you how many years of measurements you can take and how much of that measurement &quot;memory&quot; is already used, see above. If you want to measure for longer periods you may need to increase <code>max_measurements</code> by setting it as a keyword argument, e.g. <code>RainGauge(spectral_grid, max_measurements=1_000_000)</code></p><h2 id="Adding-RainGauge-as-callback"><a class="docs-heading-anchor" href="#Adding-RainGauge-as-callback">Adding RainGauge as callback</a><a id="Adding-RainGauge-as-callback-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-RainGauge-as-callback" title="Permalink"></a></h2><p>The <code>RainGauge</code> is implemented as a <code>&lt;: SpeedyWeather.AbstractCallback</code> (<code>&lt;:</code> means &quot;subtype of&quot;). A <a href="https://speedyweather.github.io/SpeedyWeather.jl/dev/callbacks/#Callbacks">Callback</a> is an object (technically a <code>struct</code> introducing a new type that belongs to the supertype <code>AbstractCallback</code>) with methods defined that are executed after every time step of the model. A callback therefore allows you to inject any piece of code into a simulation. Many callbacks are &quot;diagnostic&quot; meaning they just read out variables but you could also define &quot;intrusive&quot; callbacks that change the model or the simulation while it is running (not covered here but see <a href="https://speedyweather.github.io/SpeedyWeather.jl/dev/callbacks/#intrusive_callbacks">Intrusive callbacks</a>).</p><p>A <code>RainGauge</code> can be added to a model with <code>add!</code></p><pre><code class="language-julia hljs">model = PrimitiveWetModel(spectral_grid)
add!(model, rain_gauge)</code></pre><p>Note that you can create many different (or same) <code>RainGauge</code>s and add them all to your model in the same way. This way you can place several &quot;weather stations&quot; across the globe and measure simultaneously. Note that you will need to create several independent <code>RainGauge</code>s for that, adding the same <code>RainGauge</code> several times to the model is unlikely what you will want to do (it will measure several times the same precipitation after each time step).</p><p>You can also <code>delete!</code> a <code>RainGauge</code> (or any callback) again, but you need to know its key for that which is printed to screen when added or just inspect</p><pre><code class="language-julia hljs">model.callbacks</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{Symbol, SpeedyWeather.AbstractCallback} with 1 entry:
  :callback_Mmcl =&gt; RainGauge{Float32, AnvilInterpolator{Float32, SpeedyWeather…</code></pre><p>then with <code>delete!(model.callbacks, :callback_????)</code> where <code>:callback_????</code> is a <a href="https://docs.julialang.org/en/v1/manual/metaprogramming/#Symbols">Symbol</a> (an immutable string) identifying the callback you want to delete.</p><h2 id="Continuous-measurements-across-simulations"><a class="docs-heading-anchor" href="#Continuous-measurements-across-simulations">Continuous measurements across simulations</a><a id="Continuous-measurements-across-simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Continuous-measurements-across-simulations" title="Permalink"></a></h2><p>While you can <code>reset!(::RainGauge)</code> your rain gauge manually every time, this will not happen automatically for a new simulation if the rain gauge has already measured. This is so that you can run one simulation, look at the rain gauge measurements and then continue the simulation. Let&#39;s try this by running two 10-day simulations.</p><pre><code class="language-julia hljs">simulation = initialize!(model)
run!(simulation, period=Day(10))
rain_gauge</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">RainGauge{Float32, AnvilInterpolator{Float32, SpeedyWeather.RingGrids.GridGeometry{OctahedralGaussianGrid{SpeedyWeather.Architectures.CPU{KernelAbstractions.CPU}, Vector{UnitRange{Int64}}, Vector{Int64}}, Vector{Float64}, Vector{Int64}}, SpeedyWeather.RingGrids.AnvilLocator{Float32, Vector{Float32}, Vector{Int64}}}} &lt;: AbstractCallback
├ lond::Float64 = 358.75˚E
├ latd::Float64 = 51.75˚N
├ measurement_counter:Int = 360 (now: 2000-01-11 00:00:00)
├ tstart::DateTime = 2000-01-01T00:00:00
├ Δt::Second 2400 seconds
├ max_measurements::Int = 100000 (measuring for up to ~7.6 years, 0% recorded)
├ accumulated_rain_large_scale::Vector{Float32}, maximum: 4.8046317 mm
├ accumulated_rain_convection::Vector{Float32}, maximum: 11.936761 mm
└ accumulated total precipitation: 16.741 mm</code></pre><p>Yay, the rain gauge has measured precipitation, now let us continue</p><pre><code class="language-julia hljs">run!(simulation, period=Day(10))
rain_gauge</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">RainGauge{Float32, AnvilInterpolator{Float32, SpeedyWeather.RingGrids.GridGeometry{OctahedralGaussianGrid{SpeedyWeather.Architectures.CPU{KernelAbstractions.CPU}, Vector{UnitRange{Int64}}, Vector{Int64}}, Vector{Float64}, Vector{Int64}}, SpeedyWeather.RingGrids.AnvilLocator{Float32, Vector{Float32}, Vector{Int64}}}} &lt;: AbstractCallback
├ lond::Float64 = 358.75˚E
├ latd::Float64 = 51.75˚N
├ measurement_counter:Int = 720 (now: 2000-01-21 00:00:00)
├ tstart::DateTime = 2000-01-01T00:00:00
├ Δt::Second 2400 seconds
├ max_measurements::Int = 100000 (measuring for up to ~7.6 years, 1% recorded)
├ accumulated_rain_large_scale::Vector{Float32}, maximum: 8.537409 mm
├ accumulated_rain_convection::Vector{Float32}, maximum: 28.597273 mm
└ accumulated total precipitation: 37.135 mm</code></pre><p>which adds another 10 days of measurements as if we had simulated directly 20 days.</p><h2 id="Skipping-first-days"><a class="docs-heading-anchor" href="#Skipping-first-days">Skipping first days</a><a id="Skipping-first-days-1"></a><a class="docs-heading-anchor-permalink" href="#Skipping-first-days" title="Permalink"></a></h2><p>After a <code>rain_gauge</code> has recorded one can skip the first <code>n</code> days (or any <code>period</code>) using the <code>skip</code> function, with <code>period</code> as second argument</p><pre><code class="language-julia hljs">rain_gauge_day10to20 = skip(rain_gauge, Day(10))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">RainGauge{Float32, AnvilInterpolator{Float32, SpeedyWeather.RingGrids.GridGeometry{OctahedralGaussianGrid{SpeedyWeather.Architectures.CPU{KernelAbstractions.CPU}, Vector{UnitRange{Int64}}, Vector{Int64}}, Vector{Float64}, Vector{Int64}}, SpeedyWeather.RingGrids.AnvilLocator{Float32, Vector{Float32}, Vector{Int64}}}} &lt;: AbstractCallback
├ lond::Float64 = 358.75˚E
├ latd::Float64 = 51.75˚N
├ measurement_counter:Int = 720 (now: 2000-01-21 00:00:00)
├ tstart::DateTime = 2000-01-01T00:00:00
├ Δt::Second 2400 seconds
├ max_measurements::Int = 100000 (measuring for up to ~7.6 years, 1% recorded)
├ accumulated_rain_large_scale::Vector{Float32}, maximum: 3.732777 mm
├ accumulated_rain_convection::Vector{Float32}, maximum: 16.660511 mm
└ accumulated total precipitation: 20.393 mm</code></pre><p>(or use <code>skip!</code> as its in-place version, changing the <code>rain_gauge</code> directly). In this case, skipping the first 10 days is somewhat equivalent to only measuring the second 10 days in the example from the previous section. However, skipping does not delete the measurements in the skipped period but normalizes the accumulated rainfall so that it is zero at the end of the skipped period. And consequently the accumulated rainfall is now negative at the start of the skipped period, this is better explained through a visualisation in the next section.</p><h2 id="Visualising-RainGauge-measurements"><a class="docs-heading-anchor" href="#Visualising-RainGauge-measurements">Visualising RainGauge measurements</a><a id="Visualising-RainGauge-measurements-1"></a><a class="docs-heading-anchor-permalink" href="#Visualising-RainGauge-measurements" title="Permalink"></a></h2><p>While you always see a summary of a <code>RainGauge</code> printed to the REPL, we can also visualise all measurements nicely with <a href="https://github.com/MakieOrg/Makie.jl">Makie.jl</a>. Because RainMaker.jl has this package as a dependency (particulary the <a href="https://docs.makie.org/stable/explanations/backends/cairomakie">CairoMakie</a> backend) the only thing to do is calling the <code>RainMaker.plot</code> function. We do not export <code>plot</code> as it easily conflicts with other packages exporting a <code>plot</code> function.</p><pre><code class="language-julia hljs">RainMaker.plot(rain_gauge)</code></pre><p><img src="../rain_gauge.png" alt="Rain gauge plot"/></p><p>The <code>RainMaker.plot</code> functions takes as optional keyword argument <code>rate_Δt::Period</code> so that you can change the binwidth of the precipitation rate. Above we have one bin every 6 hours (the default), showing the average rate over the previous 6 hours. You can visualise the hourly precipitation rate with</p><pre><code class="language-julia hljs">RainMaker.plot(rain_gauge, rate_Δt=Hour(1))</code></pre><p><img src="../rain_gauge2.png" alt="Rain gauge plot, hourly rate"/></p><p>which just gives you a more fine-grained picture. Arguments can be <code>Hour(::Real)</code>, <code>Minute(::Real)</code>, <code>Day(::Real)</code> but note that the default model time step at default resolution is 30min, so you do not get any more information when going lower than that.</p><p><code>RainMaker.plot</code> also allows to skip an initial period, see <a href="#Skipping-first-days">Skipping first days</a>, which is equivalent to calling <code>plot</code> on a rain gauge which has already been skipped, e.g. <code>RainMaker.plot(rain_gauge, skip=Day(10))</code> is the same as <code>RainMaker.plot(skip(rain_gauge, Day(10)))</code>.</p><pre><code class="language-julia hljs">RainMaker.plot(rain_gauge, skip=Day(10))</code></pre><p><img src="../rain_gauge_skip.png" alt="Rain gauge plot, first 10 days skipped"/></p><p>This plot nicely illustrates what it means to &quot;skip the first 10 days&quot;: This does not delete measurements but it renormalizes the accumulated precipitation to start in the negative, crosses zero at the end of the skipped period. The total accumulated rainfall at the end of the full period is then equivalent as if no measurements would have taken place from day 0 to day 10 without actually erasing any data.</p><h2 id="Visualising-accumulated-rainfall-globally"><a class="docs-heading-anchor" href="#Visualising-accumulated-rainfall-globally">Visualising accumulated rainfall globally</a><a id="Visualising-accumulated-rainfall-globally-1"></a><a class="docs-heading-anchor-permalink" href="#Visualising-accumulated-rainfall-globally" title="Permalink"></a></h2><p>SpeedyWeather simulations diagnose the <em>accumulated</em> rainfall internally. Which is actually what a <code>RainGauge</code> reads out on every time step at the specified location (but see details in <a href="#Discarding-spin-up">Discarding spin-up</a>). This means you can also visualise a map of the accumulated rainfall since the beginning of the simulation to better understand regional rainfall patterns. SpeedyWeather uses largely SI units internally, but <code>RainGauge</code> converts meters to millimeters because that is the more common unit for rainfall. If we read out SpeedyWeather&#39;s fields manually we therefore have to do this conversion manually too. Total precipitation is the sum of convective and large-scale precipitation which we can calculate and visualise like this</p><pre><code class="language-julia hljs"># (; a, b) = struct unpacks the fields a, b in struct identified by name, equivalent to
# a = struct.a and b = struct.b
(; precip_large_scale, precip_convection) = simulation.diagnostic_variables.physics
total_precipitation = precip_large_scale + precip_convection
total_precipitation *= 1000    # convert m to mm

using CairoMakie
heatmap(total_precipitation, title=&quot;Total precipitation [mm], accumulated&quot;)</code></pre><p><img src="../total_precip_map.png" alt="Map of total accumulated precipitation"/></p><p>You can also visualise these fields individually. The accumulation starts when the model is initialized with <code>simulation = initialize!(model)</code> which constructs variables, initialized with zeros, too. This means the accumulation will continue across several <code>run!</code> calls unless you manually set it back via</p><pre><code class="language-julia hljs">simulation.diagnostic_variables.physics.precip_large_scale .= 0
simulation.diagnostic_variables.physics.precip_convection .= 0</code></pre><p>The <code>.</code> here is important to specify the broadcasting of the scalar <code>0</code> on the right to the array on the left. This was not needed in <code>*= 1000</code> above as scalar times vector/matrix is mathematicall already well defined.</p><h2 id="Discarding-spin-up"><a class="docs-heading-anchor" href="#Discarding-spin-up">Discarding spin-up</a><a id="Discarding-spin-up-1"></a><a class="docs-heading-anchor-permalink" href="#Discarding-spin-up" title="Permalink"></a></h2><p>A <code>RainGauge</code> starts measuring accumulated rainfall relative to the first <code>run!(simulation)</code> call after it has been added to the model with <code>add!</code>, see <a href="#Adding-RainGauge-as-callback">Adding RainGauge as callback</a>. This means that you can run a simulation without a <code>RainGauge</code> and then only start measuring precipitation after some time has passed. You can use this to discard any spin-up ( = adjustment after initial conditions) of a simulation. Let us illustrate this</p><pre><code class="language-julia hljs">model = PrimitiveWetModel(spectral_grid)

# add one rain gauge the measures the whole simulation
rain_gauge_from_beginning  = RainGauge(spectral_grid, lond=-1.25, latd=51.75)
add!(model, rain_gauge_from_beginning)

simulation = initialize!(model)
run!(simulation, period=Week(1))

# add another rain gauge that only starts measuring
# after that week we already simulated
rain_gauge_after_spinup  = RainGauge(spectral_grid, lond=-1.25, latd=51.75)
add!(model, rain_gauge_after_spinup)
run!(simulation, period=Day(10))

# now compare them, from the beginning
rain_gauge_from_beginning</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">RainGauge{Float32, AnvilInterpolator{Float32, SpeedyWeather.RingGrids.GridGeometry{OctahedralGaussianGrid{SpeedyWeather.Architectures.CPU{KernelAbstractions.CPU}, Vector{UnitRange{Int64}}, Vector{Int64}}, Vector{Float64}, Vector{Int64}}, SpeedyWeather.RingGrids.AnvilLocator{Float32, Vector{Float32}, Vector{Int64}}}} &lt;: AbstractCallback
├ lond::Float64 = -1.25˚E
├ latd::Float64 = 51.75˚N
├ measurement_counter:Int = 612 (now: 2000-01-18 00:00:00)
├ tstart::DateTime = 2000-01-01T00:00:00
├ Δt::Second 2400 seconds
├ max_measurements::Int = 100000 (measuring for up to ~7.6 years, 1% recorded)
├ accumulated_rain_large_scale::Vector{Float32}, maximum: 8.995389 mm
├ accumulated_rain_convection::Vector{Float32}, maximum: 24.491892 mm
└ accumulated total precipitation: 33.487 mm</code></pre><p>versus</p><pre><code class="language-julia hljs"># rain gauge after a 1-week spinup
rain_gauge_after_spinup</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">RainGauge{Float32, AnvilInterpolator{Float32, SpeedyWeather.RingGrids.GridGeometry{OctahedralGaussianGrid{SpeedyWeather.Architectures.CPU{KernelAbstractions.CPU}, Vector{UnitRange{Int64}}, Vector{Int64}}, Vector{Float64}, Vector{Int64}}, SpeedyWeather.RingGrids.AnvilLocator{Float32, Vector{Float32}, Vector{Int64}}}} &lt;: AbstractCallback
├ lond::Float64 = -1.25˚E
├ latd::Float64 = 51.75˚N
├ measurement_counter:Int = 360 (now: 2000-01-18 00:00:00)
├ tstart::DateTime = 2000-01-08T00:00:00
├ Δt::Second 2400 seconds
├ max_measurements::Int = 100000 (measuring for up to ~7.6 years, 0% recorded)
├ accumulated_rain_large_scale::Vector{Float32}, maximum: 5.3096433 mm
├ accumulated_rain_convection::Vector{Float32}, maximum: 18.477123 mm
└ accumulated total precipitation: 23.787 mm</code></pre><p>As you can see their clocks differ and so does the measured precipitation!</p><h2 id="Functions-and-types"><a class="docs-heading-anchor" href="#Functions-and-types">Functions and types</a><a id="Functions-and-types-1"></a><a class="docs-heading-anchor-permalink" href="#Functions-and-types" title="Permalink"></a></h2><ul><li><a href="#RainMaker.RainGauge"><code>RainMaker.RainGauge</code></a></li><li><a href="#RainMaker.plot-Tuple{RainGauge}"><code>RainMaker.plot</code></a></li><li><a href="#RainMaker.reset!-Tuple{RainGauge, PrognosticVariables, DiagnosticVariables, AbstractModel}"><code>RainMaker.reset!</code></a></li><li><a href="#RainMaker.reset!-Tuple{RainGauge}"><code>RainMaker.reset!</code></a></li><li><a href="#RainMaker.skip!-Tuple{RainGauge, Period}"><code>RainMaker.skip!</code></a></li><li><a href="#SpeedyWeather.callback!-Tuple{RainGauge, PrognosticVariables, DiagnosticVariables, AbstractModel}"><code>SpeedyWeather.callback!</code></a></li><li><a href="#SpeedyWeather.initialize!-Tuple{RainGauge, Vararg{Any}}"><code>SpeedyWeather.initialize!</code></a></li></ul><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="RainMaker.RainGauge" href="#RainMaker.RainGauge"><code>RainMaker.RainGauge</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Measures convective and large-scale precipitation across time at one given location with linear interpolation from model grids onto <code>lond</code>, <code>latd</code>. Fields are </p><ul><li><p><code>lond::Float64</code>: [OPTION] Longitude [0 to 360˚E] where to measure precipitation.</p></li><li><p><code>latd::Float64</code>: [OPTION] Latitude [-90˚ to 90˚N] where to measure precipitation.</p></li><li><p><code>interpolator::Any</code>: [OPTION] To interpolate precipitation fields onto lond, latd.</p></li><li><p><code>max_measurements::Int64</code>: [OPTION] Maximum number of time steps used to allocate memory.</p></li><li><p><code>measurement_counter::Int64</code>: [OPTION] Measurement counter (one per time step), starting at 0 for uninitialized.</p></li><li><p><code>tstart::DateTime</code>: Start time of gauge.</p></li><li><p><code>Δt::Second</code>: Spacing between time steps.</p></li><li><p><code>accumulated_rain_large_scale_start::Any</code>: Accumulated large-scale precipitation [mm] in the simulation at the beginning of rain gauge measurements.</p></li><li><p><code>accumulated_rain_convection_start::Any</code>: Accumulated large-scale precipitation [mm] in the simulation at the beginning of rain gauge measurements.</p></li><li><p><code>accumulated_rain_large_scale::Vector</code>: Accumulated large-scale precipitation [mm].</p></li><li><p><code>accumulated_rain_convection::Vector</code>: Accumulated convective precipitation [mm].</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SpeedyWeather/RainMaker.jl/blob/5c7389cc8e8127b5ec7e1ee5f3708fe2223175ab/src/rain_gauge.jl#L9-L13">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="RainMaker.plot-Tuple{RainGauge}" href="#RainMaker.plot-Tuple{RainGauge}"><code>RainMaker.plot</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">plot(gauge::RainGauge; skip, rate_Δt) -&gt; Figure
</code></pre><p>Plot accumulated precipitation and precipitation rate across time for <code>gauge::RainGauge</code> from <code>RainMaker.jl</code>. <code>rate_Δt</code> specifies the interval used to bin the precipitation rate, while units are always converted to mm/day. Default is 6 hours.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SpeedyWeather/RainMaker.jl/blob/5c7389cc8e8127b5ec7e1ee5f3708fe2223175ab/src/rain_gauge.jl#L211">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="RainMaker.reset!-Tuple{RainGauge, PrognosticVariables, DiagnosticVariables, AbstractModel}" href="#RainMaker.reset!-Tuple{RainGauge, PrognosticVariables, DiagnosticVariables, AbstractModel}"><code>RainMaker.reset!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reset!(
    gauge::RainGauge,
    progn::PrognosticVariables,
    diagn::DiagnosticVariables,
    model::AbstractModel
)
</code></pre><p>Reset <code>gauge::RainGauge</code> to its initial state, but use time and Δt from clock.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SpeedyWeather/RainMaker.jl/blob/5c7389cc8e8127b5ec7e1ee5f3708fe2223175ab/src/rain_gauge.jl#L107">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="RainMaker.reset!-Tuple{RainGauge}" href="#RainMaker.reset!-Tuple{RainGauge}"><code>RainMaker.reset!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reset!(gauge::RainGauge) -&gt; RainGauge
</code></pre><p>Reset <code>gauge::RainGauge</code> to its initial state, i.e. set <code>measurement_counter</code> to 0, <code>tstart</code> to <code>DEFAULT_DATE</code>, <code>Δt</code> to <code>DEFAULT_ΔT</code>, and set accumulated precipitation vector to zeros.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SpeedyWeather/RainMaker.jl/blob/5c7389cc8e8127b5ec7e1ee5f3708fe2223175ab/src/rain_gauge.jl#L93">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="RainMaker.skip!-Tuple{RainGauge, Period}" href="#RainMaker.skip!-Tuple{RainGauge, Period}"><code>RainMaker.skip!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">skip!(
    rain_gauge::RainGauge,
    period::Period
) -&gt; Union{Nothing, RainGauge}
</code></pre><p>Renormalize a <code>rain_gauge</code> to skip the first <code>period</code> (e.g. 5 days) of measurements.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SpeedyWeather/RainMaker.jl/blob/5c7389cc8e8127b5ec7e1ee5f3708fe2223175ab/src/rain_gauge.jl#L132">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpeedyWeather.callback!-Tuple{RainGauge, PrognosticVariables, DiagnosticVariables, AbstractModel}" href="#SpeedyWeather.callback!-Tuple{RainGauge, PrognosticVariables, DiagnosticVariables, AbstractModel}"><code>SpeedyWeather.callback!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">callback!(
    gauge::RainGauge,
    progn::PrognosticVariables,
    diagn::DiagnosticVariables,
    model::AbstractModel
)
</code></pre><p>Callback definition for <code>gauge::RainGauge</code> from <code>RainMaker.jl</code>. Interpolates large-scale and convective precipitation to the gauge&#39;s storage vectors and converts units from m to mm. Stops measuring if the <code>max_measurements</code> are reached which is printed only once as info.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SpeedyWeather/RainMaker.jl/blob/5c7389cc8e8127b5ec7e1ee5f3708fe2223175ab/src/rain_gauge.jl#L171">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SpeedyWeather.initialize!-Tuple{RainGauge, Vararg{Any}}" href="#SpeedyWeather.initialize!-Tuple{RainGauge, Vararg{Any}}"><code>SpeedyWeather.initialize!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">initialize!(
    gauge::RainGauge,
    args...
) -&gt; Union{Nothing, RainGauge}
</code></pre><p>Initialize <code>gauge::RainGauge</code> by calling <code>reset!(::RainGauge)</code> but only if <code>gauge</code> is not already initialized (<code>gauge.measurement_counter &gt; 0</code>), so that it can be re-used across several simulation runs.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SpeedyWeather/RainMaker.jl/blob/5c7389cc8e8127b5ec7e1ee5f3708fe2223175ab/src/rain_gauge.jl#L83">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../new_to_julia/">« New to Julia?</a><a class="docs-footer-nextpage" href="../instructions/">Instructions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 22 July 2025 12:16">Tuesday 22 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
